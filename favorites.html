<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <title>我的收藏 • Konamon Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
    <style>
        /* 收藏页专属补充样式 */

        body.favorites {
            background: #fafafa;
            font-family: 'Noto Sans JP', 'Segoe UI', sans-serif;
            margin: 0;
            color: #333;
        }

        header.fav-header {
            position: sticky;
            top: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 22px;
            background: rgba(255,255,255,0.75);
            backdrop-filter: blur(12px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            z-index: 1000;
        }
        header.fav-header h1 {
            font-size: 1.3rem;
            color: #ff7043;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        header.fav-header button {
            background: none;
            border: none;
            font-size: 1rem;
            color: #444;
            cursor: pointer;
            transition: color .2s ease;
        }
        header.fav-header button:hover { color: #ff7043; }

        main#fav-container {
            max-width: 740px;
            margin: 30px auto 80px;
            padding: 0 18px;
        }

        .fav-card {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 18px 20px;
            margin-bottom: 16px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.08);
            transition: all .25s ease;
        }
        .fav-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
        }

        .fav-card h3 {
            margin: 0 0 6px;
            font-size: 1.15rem;
            font-weight: 700;
            color: #333;
        }
        .fav-meta {
            font-size: 0.9em;
            color: #777;
            margin-bottom: 8px;
        }
        .fav-desc {
            font-size: 0.95em;
            color: #555;
            margin-bottom: 10px;
            line-height: 1.5em;
        }
        .fav-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        /* 按钮统一风格 */
        .primary {
            background: linear-gradient(135deg, #ff7043, #ff5252);
            color: #fff;
            border: none;
            border-radius: 10px;
            padding: 8px 14px;
            font-weight: 600;
            transition: all .25s ease;
            cursor: pointer;
        }
        .primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255,82,82,0.35);
        }
        .secondary {
            background: rgba(255,255,255,0.9);
            border: 1px solid #ddd;
            color: #333;
            border-radius: 10px;
            padding: 8px 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all .25s ease;
        }
        .secondary:hover {
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        footer.fav-footer {
            text-align: center;
            color: #aaa;
            font-size: 0.85em;
            padding: 14px 0;
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.3);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
        }
    </style>
</head>

<body class="favorites">
<header class="fav-header">
    <h1>❤ 我的收藏</h1>
    <button onclick="window.location.href='index.html'">← 返回地图</button>
</header>

<main id="fav-container"></main>

<footer class="fav-footer">
    © Konamon Map Final++
</footer>

<script src="shops.js"></script>
<script>
    const FAVS_KEY='km_favs_v1';
    const FAV_DATES_KEY='km_fav_dates_v1';
    const DAILY_KEY='km_daily_v1';

    function todayStr(){ return new Date().toISOString().slice(0,10); }
    function load(k,f){ try{ return JSON.parse(localStorage.getItem(k)) ?? f; }catch{ return f; } }
    function save(k,v){ localStorage.setItem(k, JSON.stringify(v)); }

    function render(){
        const wrap=document.getElementById('fav-container');
        const favs=load(FAVS_KEY,[]);
        if(!window.shops||favs.length===0){
            wrap.innerHTML=`<div class="fav-card" style="text-align:center;">暂无收藏，去地图页看看吧～</div>`;
            return;
        }
        wrap.innerHTML='';
        favs.forEach(name=>{
            const shop=(window.shops||[]).find(s=>s.name===name);
            if(!shop) return;
            const card=document.createElement('div');
            card.className='fav-card';
            card.innerHTML=`
          <h3>${shop.name}</h3>
          <div class="fav-meta">评分 ${shop.rating} ／ 类型 ${shop.category}</div>
          <div class="fav-desc">${shop.details}</div>
          <div class="fav-actions">
            <button class="primary" onclick="window.open('https://www.google.com/maps/dir/?api=1&destination=${shop.coords[0]},${shop.coords[1]}','_blank')">📍 前往导航</button>
            <button class="secondary" onclick="removeFav('${shop.name}')">取消收藏</button>
          </div>`;
            wrap.appendChild(card);
        });
    }

    function removeFav(name){
        const favs=load(FAVS_KEY,[]).filter(n=>n!==name);
        save(FAVS_KEY,favs);
        const favDates=load(FAV_DATES_KEY,{});
        const wasToday=favDates[name]===todayStr();
        delete favDates[name];
        save(FAV_DATES_KEY,favDates);
        if(wasToday){
            const daily=load(DAILY_KEY,{});
            const t=todayStr();
            if(daily[t]&&daily[t].favCount>0){
                daily[t].favCount-=1;
                if(daily[t].favCount<5) daily[t].favDone=false;
                save(DAILY_KEY,daily);
            }
        }
        render();
    }

    render();
</script>
</body>
</html>
